# é¡¹ç›®æœªå¤„ç†å¼‚å¸¸é€»è¾‘åˆ†ææŠ¥å‘Š

## é¡¹ç›®è·¯å¾„: d:\Flutter Project Files\teacher_daily_tool

---

## ä¸€ã€äº‹ä»¶å¤„ç†å™¨ä¸­çš„å¼‚å¸¸

### 1. App.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 246-286 | `handleImportFavorites` ä¸­ `FileReader` çš„ `onload` å›è°ƒä¸­ `JSON.parse` æœªå¤„ç†è§£æå¼‚å¸¸ | é«˜ | åœ¨ try-catch å—ä¸­åŒ…è£¹ JSON.parse å¹¶æ·»åŠ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º |
| 247-252 | æ–‡ä»¶æ‰©å±•åæ£€æŸ¥ä½¿ç”¨ `split('.').pop()` å¯èƒ½è¿”å› undefined | ä¸­ | æ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼š`const extension = file.name.split('.').pop()?.toLowerCase()` åéªŒè¯ extension å­˜åœ¨ |
| 260-261 | `parsed.filter` ä¸­ `item.id` å’Œ `item.title` å¯èƒ½ä¸º undefined | ä¸­ | æ·»åŠ æ›´ä¸¥æ ¼çš„éªŒè¯é€»è¾‘ï¼š`const validItems = parsed.filter((item: any) => item && typeof item.id !== 'undefined' && item.title && item.content)` |
| 288-290 | `handleViewChange` ç®€å•è®¾ç½®çŠ¶æ€ï¼Œä½†å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ | ä½ | ç¡®ä¿ç»„ä»¶å¸è½½æ—¶å–æ¶ˆæœªå®Œæˆçš„å¼‚æ­¥æ“ä½œ |
| 584-591 | `handleSubjectChange` è°ƒç”¨ `saveCurrentPageToCache()` å’Œ `restorePageFromCache()` ä½†æœªå¤„ç†å¯èƒ½çš„ localStorage å¼‚å¸¸ | ä¸­ | åœ¨è¿™äº›å‡½æ•°ä¸­æ·»åŠ  try-catch å— |
| 593-600 | `handleFunctionChange` åŒä¸Šï¼Œæœªå¤„ç† localStorage å¼‚å¸¸ | ä¸­ | åŒä¸Š |

### 2. AIPaperGenerator.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 1024-1032 | `processFiles` ä¸­ `FileReader` è¯»å–æ–‡æœ¬æ–‡ä»¶æ—¶ `reader.onload` æœªå¤„ç†é”™è¯¯æƒ…å†µ | é«˜ | æ·»åŠ  `reader.onerror` å¤„ç†ç¨‹åº |
| 1226-1272 | `handleGenerate` è°ƒç”¨å¼‚æ­¥ thunk ä½†æœªåœ¨ç»„ä»¶ä¸­å¤„ç†é”™è¯¯çŠ¶æ€ | ä¸­ | åœ¨ dispatch åæ£€æŸ¥è¿”å›çš„ promise å¹¶å¤„ç†é”™è¯¯ |
| 1274-1296 | `handleDownload` å’Œ `handleDownloadDocx` æœªå¤„ç†å¯èƒ½çš„ DOM æ“ä½œå¼‚å¸¸ | ä¸­ | æ·»åŠ  try-catch åŒ…è£¹ DOM æ“ä½œ |

### 3. AvatarEditor.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 41-62 | `handleFileChange` ä¸­ `FileReader` ç¼ºå°‘ `onerror` å¤„ç† | é«˜ | æ·»åŠ  `reader.onerror = () => { console.error('File read failed'); onClose(); }` |
| 44-57 | `img.onload` å›è°ƒä¸­æœªå¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥ | ä¸­ | æ·»åŠ  `img.onerror` å¤„ç†ç¨‹åº |
| 132-140 | `handleSave` ä¸­ `canvas.toDataURL` å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼ˆå¦‚æœ canvas è¢«æ±¡æŸ“ï¼‰ | ä¸­ | æ·»åŠ  try-catch å— |

### 4. FavoritesPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 66-78 | `toggleSelection` ä¸­ `alert(t('fav_max_selection_replaced'))` å¦‚æœç¿»è¯‘å‡½æ•°è¿”å› undefined ä¼šå¯¼è‡´æ˜¾ç¤ºé—®é¢˜ | ä½ | æ·»åŠ é»˜è®¤å€¼ï¼š`alert(t('fav_max_selection_replaced') \|\| 'Maximum selection reached')` |
| 112-143 | `executeExport` æœ‰é”™è¯¯å¤„ç†ä½†ä»…è®¾ç½®çŠ¶æ€ï¼Œæœªå‘ç”¨æˆ·æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯ | ä¸­ | æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æç¤ºï¼ŒåŒ…å«å¤±è´¥åŸå›  |
| 154-160 | `handleSingleExport` è°ƒç”¨ `executeExport` ä½†æœªä¼ é€’é”™è¯¯å¤„ç† | ä½ | ç¡®ä¿é”™è¯¯è¢«æ­£ç¡®ä¼ æ’­ |

### 5. SettingsPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 67-78 | `handleBind` ä½¿ç”¨ `setTimeout` æ¨¡æ‹Ÿ API è°ƒç”¨ï¼Œå®é™…å®ç°æ—¶å¯èƒ½é—æ¼é”™è¯¯å¤„ç† | ä¸­ | ç¡®ä¿å®é™… API è°ƒç”¨æœ‰ try-catch åŒ…è£¹ |
| 80-90 | `handleBackgroundUpload` ä¸­ `FileReader` ç¼ºå°‘ `onerror` å¤„ç† | é«˜ | æ·»åŠ  `reader.onerror` å¤„ç†ç¨‹åº |
| 109-137 | `handleClearResourcesClick` ä¸­ `await onClearResources()` å¯èƒ½æŠ›å‡ºå¼‚å¸¸ | ä¸­ | æ·»åŠ  try-catch å—åŒ…è£¹ await è°ƒç”¨ |

### 6. LessonPlanCard.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 79-101 | `handleCopy` ä¸­ `navigator.clipboard.writeText` åœ¨æ—§æµè§ˆå™¨æˆ–ä¸å®‰å…¨ä¸Šä¸‹æ–‡ä¸­å¯èƒ½å¤±è´¥ï¼Œè™½æœ‰ catch ä½†ä»… console.error | ä¸­ | æ·»åŠ ç”¨æˆ·åé¦ˆï¼Œå¦‚ Toast æç¤ºå¤åˆ¶å¤±è´¥ |
| 103-114 | `handleShare` åŒä¸Šï¼Œé”™è¯¯å¤„ç†ä»… alert | ä½ | ç»Ÿä¸€ä½¿ç”¨ Toast ç»„ä»¶æ›¿ä»£ alert |
| 115-127 | `initiateDownload` è°ƒç”¨ downloadService æ–¹æ³•ï¼Œcatch å—ä»… alert | ä½ | ç»Ÿä¸€ä½¿ç”¨ Toast ç»„ä»¶æ›¿ä»£ alert |

### 7. LessonActionFooter.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 26-44 | `handleConfirmDownload` æœ‰ try-catch ä½†é”™è¯¯å¤„ç†ç®€å•ï¼Œä¸”æœªåŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ | ä¸­ | ç»†åŒ–é”™è¯¯ç±»å‹ï¼Œæä¾›æ›´å…·ä½“çš„é”™è¯¯æ¶ˆæ¯ |

### 8. Sidebar.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 51-66 | `handleAvatarInteraction` è°ƒç”¨çš„äº‹ä»¶å¤„ç†å™¨é€»è¾‘å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ | ä½ | ç®€åŒ–çŠ¶æ€é€»è¾‘ï¼Œç¡®ä¿äº‹ä»¶å†’æ³¡æ­£ç¡®å¤„ç† |
| 74-80 | `handleSaveAvatar` è®¾ç½® sparkles æ•ˆæœä½†æ— é”™è¯¯å¤„ç† | ä½ | å½“å‰æ— é—®é¢˜ï¼Œä½†å»ºè®®ç¡®ä¿åŠ¨ç”»åº“åŠ è½½æ­£å¸¸ |

---

## äºŒã€useEffect ä¸­çš„å¼‚æ­¥æ“ä½œå¼‚å¸¸

### 1. App.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 109-220 | `applyTheme` useEffect ä¸­çš„å¼‚æ­¥é¢œè‰²æå– `getAverageColor` æœ‰ try-catch ä½†ä»… console.warnï¼Œå¯èƒ½å¯¼è‡´ä¸»é¢˜åº”ç”¨ä¸å®Œæ•´ | ä¸­ | æ·»åŠ å¤‡ç”¨é¢œè‰²æ–¹æ¡ˆï¼Œç¡®ä¿ä¸»é¢˜å§‹ç»ˆå¯ç”¨ |
| 342-346 | `handleResize` äº‹ä»¶ç›‘å¬å™¨æœªå¤„ç†å¯èƒ½çš„å¼‚å¸¸ | ä½ | é€šå¸¸æ— éœ€å¤„ç†ï¼Œä½†å»ºè®®ç¡®è®¤ window å¯¹è±¡å¯ç”¨ |
| 350-356 | ç‚¹å‡»å¤–éƒ¨äº‹ä»¶ç›‘å¬å™¨æœ‰æ¸…ç†å‡½æ•°ï¼Œä½† `setSlidingRecentId` å¯èƒ½å·²å¸è½½ | ä¸­ | ä½¿ç”¨ ref æ ‡è®°ç»„ä»¶æŒ‚è½½çŠ¶æ€ |
| 358-369 | åŒä¸Š | ä¸­ | åŒä¸Š |
| 504-509 | `textbookUnit` ç­‰çŠ¶æ€é‡ç½®ï¼Œæ— å‰¯ä½œç”¨å¤„ç† | ä½ | æ— éœ€ä¿®æ”¹ |
| 510-516 | åŒä¸Š | ä½ | æ— éœ€ä¿®æ”¹ |
| 522-551 | `textbookUnit` å˜åŒ–å¤„ç†é€»è¾‘å¤æ‚ï¼Œå¤šå¤„ dispatch å¯èƒ½å¼•å‘ç«æ€æ¡ä»¶ | ä¸­ | ä½¿ç”¨ cleanup å‡½æ•°æˆ–åˆå¹¶ dispatch è°ƒç”¨ |
| 552-580 | é¡µç å˜åŒ–å¤„ç†ï¼ŒåŒä¸Š | ä¸­ | åŒä¸Š |
| 602-604 | `hasAnalyzedOnce` é‡ç½® | ä½ | æ— éœ€ä¿®æ”¹ |
| 606-609 | ä¸»é¢˜ç±»åå¤„ç† | ä½ | æ— éœ€ä¿®æ”¹ |
| 620-639 | localStorage è¯»å–æœ‰ try-catch ä½†ä¸ºç©º | ä¸­ | æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½• |
| 647-657 | åŒä¸Š | ä¸­ | åŒä¸Š |
| 658-666 | localStorage å†™å…¥æœ‰ try-catch ä½†ä¸ºç©º | ä¸­ | åŒä¸Š |
| 667-678 | `setTimeout` æ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |
| 717-723 | `isAnalyzing` çŠ¶æ€ç›‘å¬ | ä½ | æ— éœ€ä¿®æ”¹ |
| 724-728 | `isLoading` çŠ¶æ€ç›‘å¬ | ä½ | æ— éœ€ä¿®æ”¹ |
| 837-877 | ä¸»é¢˜åº”ç”¨ useEffectï¼Œæœ‰ try-catch ä½†ä¸ºç©º | ä¸­ | æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½• |
| 902-913 | æ»šåŠ¨æŒ‡ç¤ºå™¨äº‹ä»¶ç›‘å¬ï¼Œæ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |
| 916-918 | localStorage å†™å…¥ï¼Œæ— å¼‚å¸¸å¤„ç† | ä½ | æ·»åŠ  try-catch |
| 1207-1232 | `reduxGeneratedPlan` ç›‘å¬é€»è¾‘å¤æ‚ | ä¸­ | æ£€æŸ¥ `lastPlanRef` å’Œ `currentPlanOriginRef` çš„æ¸…ç† |

### 2. AIPaperGenerator.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 64-112 | `totalPages` è®¡ç®— useEffect ä¾èµ– `[paper, template, isMock, displayTitle]`ï¼Œä½† `containerRef.current` å¯èƒ½ä¸º null | ä½ | æ·»åŠ ç©ºå€¼æ£€æŸ¥ |
| 980-990 | ä¸»é¢˜åˆå§‹åŒ– useEffect ä¾èµ–ä¸ºç©ºæ•°ç»„å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ | ä½ | è€ƒè™‘æ·»åŠ  `theme` ä½œä¸ºä¾èµ– |
| 1299-1303 | `paperType` åˆå§‹åŒ–ï¼Œdispatch å¯èƒ½å¤±è´¥ | ä½ | æ·»åŠ é”™è¯¯å¤„ç† |

### 3. SettingsPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 45-65 | localStorage è®¡ç®—ç¼“å­˜å¤§å°ï¼Œæœ‰ try-catch ä½†ä¸ºç©º | ä¸­ | æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½• |

### 4. Sidebar.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 43-49 | `showMenu` äº‹ä»¶ç›‘å¬å™¨ï¼Œæ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |

### 5. FavoritesPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 47-55 | `exportMenuRef` ç‚¹å‡»å¤–éƒ¨ç›‘å¬å™¨ï¼Œæ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |

### 6. AvatarEditor.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 25-39 | `setTimeout` ç‚¹å‡»æ–‡ä»¶è¾“å…¥ï¼Œæ— æ¸…ç† | ä½ | æ·»åŠ æ¸…ç†å‡½æ•°è¿”å› |
| 111-113 | `draw` ä¾èµ–å˜åŒ–è°ƒç”¨ï¼Œæ— é”™è¯¯å¤„ç† | ä½ | `draw` å‡½æ•°å†…éƒ¨æœ‰åŸºæœ¬æ£€æŸ¥ |

### 7. SyncInput.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 15-17 | `rawContent` åŒæ­¥ï¼Œæ­£å¸¸ | ä½ | æ— éœ€ä¿®æ”¹ |
| 20-40 | é˜²æŠ– effectï¼Œæ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |

### 8. Toast.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 18-23 | `setTimeout` æ¸…ç†æ­£ç¡® | ä½ | æ— éœ€ä¿®æ”¹ |

---

## ä¸‰ã€æ–‡ä»¶è¯»å†™ã€å›¾ç‰‡å¤„ç†çš„å¼‚å¸¸

### 1. AvatarEditor.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 41-62 | æ–‡ä»¶è¯»å–æœªéªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å° | é«˜ | æ·»åŠ æ–‡ä»¶ç±»å‹éªŒè¯ï¼ˆä»…å…è®¸å›¾ç‰‡ï¼‰å’Œå¤§å°é™åˆ¶ |
| 65-109 | `draw` å‡½æ•°ä¸­ `canvas.getContext('2d')` å¯èƒ½è¿”å› null | ä¸­ | æ·»åŠ  null æ£€æŸ¥ |
| 99 | `ctx.drawImage` å¯èƒ½åœ¨å›¾ç‰‡æœªå®Œå…¨åŠ è½½æ—¶è°ƒç”¨ | ä¸­ | ç¡®ä¿å›¾ç‰‡å·²åŠ è½½å®Œæˆ |

### 2. App.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 920-971 | `analyzeImageFile` ä¸­ `FileReader` ç¼ºå°‘ `onerror` å¤„ç† | é«˜ | æ·»åŠ  `reader.onerror` å¤„ç†ç¨‹åº |
| 972-1018 | `handleFilesSelected` å¤„ç†å¤šç§æ–‡ä»¶ç±»å‹ï¼Œä½†é”™è¯¯å¤„ç†ä¸å®Œæ•´ | é«˜ | ç»Ÿä¸€æ·»åŠ  try-catch å¹¶ç»™ç”¨æˆ·åé¦ˆ |
| 1764-1768 | æ–‡ä»¶è¾“å…¥ `onChange` ç›´æ¥ä¼ é€’æ–‡ä»¶ç»™å¤„ç†å™¨ï¼Œæ— å‰ç½®éªŒè¯ | ä¸­ | æ·»åŠ æ–‡ä»¶å¤§å°å’Œç±»å‹å‰ç½®éªŒè¯ |

### 3. SettingsPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 80-90 | èƒŒæ™¯å›¾ç‰‡ä¸Šä¼ æœªéªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å° | é«˜ | æ·»åŠ éªŒè¯ï¼šä»…å…è®¸å›¾ç‰‡ï¼Œé™åˆ¶å¤§å°ï¼ˆå¦‚æœ€å¤§ 5MBï¼‰ |

### 4. AIPaperGenerator.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 997-1014 | æ–‡ä»¶ä¸Šä¼ å¤„ç† (`handleFileUpload`, `handleImageUpload`) ç¼ºå°‘é”™è¯¯å¤„ç† | é«˜ | æ·»åŠ  `onerror` å¤„ç†ç¨‹åº |
| 1016-1039 | `processFiles` ä¸­ `FileReader` ç¼ºå°‘ `onerror` å¤„ç† | é«˜ | æ·»åŠ  `reader.onerror` å¤„ç†ç¨‹åº |

### 5. LessonPlanCard.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 33-42 | `ensureMathJax` è„šæœ¬åŠ è½½æ— é”™è¯¯å¤„ç† | ä¸­ | æ·»åŠ  `script.onerror` å¤„ç†ç¨‹åº |
| 44-62 | `MDWithMath` ä¸­ `mj.typesetPromise` å¯èƒ½å¤±è´¥ | ä¸­ | æ·»åŠ  try-catch å— |

---

## å››ã€çŠ¶æ€æ›´æ–°æ—¶çš„æ½œåœ¨é”™è¯¯

### 1. App.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 61-78 | Redux selector è·å–å¤šä¸ªçŠ¶æ€ï¼Œå¯èƒ½è¿”å› undefined | ä¸­ | ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ï¼š`useSelector((state: RootState) => state.lesson?.topic)` |
| 88-90 | `isMobile` è®¡ç®—ä½¿ç”¨ `navigator.userAgent` åœ¨ SSR ç¯å¢ƒä¼šæŠ¥é”™ | é«˜ | æ·»åŠ  `typeof navigator !== 'undefined'` æ£€æŸ¥ |
| 298 | `favorites` åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„ï¼Œä½†ç±»å‹å®šä¹‰å¯èƒ½ä¸åŒ¹é… | ä½ | ç¡®ä¿ç±»å‹å®šä¹‰å®Œæ•´ |
| 341 | `windowWidth` åˆå§‹åŒ–ä½¿ç”¨ `window` å¯¹è±¡ï¼ŒSSR ä¼šæŠ¥é”™ | é«˜ | æ·»åŠ  `typeof window !== 'undefined'` æ£€æŸ¥ |
| 729-744 | `handleToggleFavorite` ä¸­ `favorites.find` å‡è®¾ `favorites` æ€»æ˜¯æ•°ç»„ | ä¸­ | æ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼š`favorites?.find(...)` |
| 757-776 | `commitRename` ä¸­ `targetKey` å¯èƒ½ä¸º nullï¼Œä½†åç»­ä½¿ç”¨æœªæ£€æŸ¥ | ä¸­ | æ·»åŠ éç©ºæ£€æŸ¥åå†ä½¿ç”¨ |

### 2. AIPaperGenerator.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 916-926 | ä½¿ç”¨ `useSelector` è·å–åµŒå¥—çŠ¶æ€ï¼Œå¦‚æœçˆ¶çŠ¶æ€æœªåˆå§‹åŒ–ä¼šæŠ¥é”™ | ä¸­ | æ·»åŠ é»˜è®¤å€¼æˆ–ä½¿ç”¨å¯é€‰é“¾ |
| 957-970 | `listeningScore` å’Œ `writingScore` è®¡ç®—ï¼Œå¦‚æœ `questionConfig` ä¸º undefined ä¼šæŠ¥é”™ | ä¸­ | æ·»åŠ é»˜è®¤å€¼ï¼š`questionConfig \|\| {}` |

### 3. FavoritesPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 57-59 | `sortedFavorites` è®¡ç®—å‡è®¾ `favorites` æ˜¯æ•°ç»„ï¼Œå¦‚æœä¸º undefined ä¼šæŠ¥é”™ | ä¸­ | æ·»åŠ é»˜è®¤å€¼ï¼š`[...(favorites \|\| [])]` |

### 4. PreviewContainer.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 14-20 | `displayPlan` è®¡ç®—ä½¿ç”¨ `(generatedPlan as any)[language]`ï¼Œå¦‚æœ generatedPlan ä¸º null ä¼šæŠ¥é”™ | ä¸­ | æ·»åŠ å‰ç½®æ£€æŸ¥ |

### 5. Sidebar.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 31 | ä½¿ç”¨ `useSelector` è·å–çŠ¶æ€ï¼Œå¦‚æœ Redux æœªæ­£ç¡®åˆå§‹åŒ–å¯èƒ½æŠ¥é”™ | ä½ | ç¡®ä¿ Provider å·²æ­£ç¡®åŒ…è£¹ |
| 40 | `currentNickname` è®¡ç®—ä¾èµ– `reduxNickname`ï¼Œå¯èƒ½ä¸º undefined | ä½ | å·²å¤„ç†ï¼Œä½¿ç”¨é»˜è®¤å€¼ |

### 6. TeachingMethodSelector.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 12-14 | ä½¿ç”¨ `useSelector` è·å–çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€æœªåˆå§‹åŒ–å¯èƒ½æŠ¥é”™ | ä½ | ç¡®ä¿ Redux store æœ‰é»˜è®¤å€¼ |

### 7. SyncInput.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 11 | `rawContent` å¯èƒ½ä¸º undefined | ä½ | æ·»åŠ é»˜è®¤å€¼ï¼š`useState(rawContent \|\| '')` |
| 27-35 | `generatedPlan` è§£æ„å¯èƒ½å¤±è´¥ | ä¸­ | æ·»åŠ æ£€æŸ¥ï¼š`if (generatedPlan && typeof generatedPlan === 'object')` |

---

## äº”ã€æœªæ£€æŸ¥çš„ç©ºå€¼/undefined

### 1. App.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 171 | `file.name.split('.').pop()` å¯èƒ½è¿”å› undefined | ä¸­ | æ·»åŠ ç©ºå€¼åˆå¹¶ï¼š`?.toLowerCase() \|\| ''` |
| 227 | `navigator` å¯¹è±¡å¯èƒ½ä¸å­˜åœ¨ï¼ˆSSRï¼‰ | é«˜ | æ·»åŠ  `typeof navigator !== 'undefined'` æ£€æŸ¥ |
| 341 | `window` å¯¹è±¡å¯èƒ½ä¸å­˜åœ¨ï¼ˆSSRï¼‰ | é«˜ | æ·»åŠ  `typeof window !== 'undefined'` æ£€æŸ¥ |
| 612 | `computePlanKey` ä¸­ `plan` å‚æ•°å¯èƒ½ä¸º null | ä¸­ | æ·»åŠ å‰ç½®æ£€æŸ¥ |
| 686-688 | `getPlanTitle` ä¸­ `(plan as any)` å‡è®¾ plan æ€»æœ‰å±æ€§ | ä¸­ | ä½¿ç”¨å¯é€‰é“¾ï¼š`(plan as any)?.title_zh` |
| 1147-1158 | `handleWordsChange` ä¸­ `e.target.value` å¯èƒ½ä¸º undefined | ä½ | é€šå¸¸ä¸ä¼šå‡ºç°ï¼Œä½†å¯æ·»åŠ é˜²å¾¡æ€§ç¼–ç¨‹ |

### 2. AIPaperGenerator.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 68 | `grade.replace` å‡è®¾ grade æ˜¯å­—ç¬¦ä¸² | ä¸­ | æ·»åŠ é»˜è®¤å€¼ï¼š`grade \|\| ''` |
| 74-78 | `t` å‡½æ•°è¿”å›å€¼å¯èƒ½ä¸º undefined | ä½ | ç¡®ä¿ç¿»è¯‘æ–‡ä»¶å®Œæ•´ |
| 82-103 | `headerTitle` è®¡ç®—ä¸­ `displayTitle?.trim()` å·²å¤„ç†ç©ºå€¼ | ä½ | å½“å‰å®ç°æ­£ç¡® |
| 192-195 | `toChineseNum` ä¸­ `map[num]` å¯èƒ½ä¸º undefined | ä½ | æ·»åŠ é»˜è®¤å€¼ï¼š`map[num] \|\| num.toString()` å·²å¤„ç† |
| 198-199 | `paper.sections.filter` å‡è®¾ sections å­˜åœ¨ | ä¸­ | æ·»åŠ é»˜è®¤å€¼ï¼š`paper?.sections \|\| []` |
| 480-483 | åˆ†æ•°è®¡ç®—ä¸­ `questionConfig[qTypeMatch]` å¯èƒ½ä¸º undefined | ä¸­ | æ·»åŠ å¯é€‰é“¾ï¼š`questionConfig?.[qTypeMatch]` |

### 3. SettingsPage.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 81 | `e.target.files?.[0]` å·²ä½¿ç”¨å¯é€‰é“¾ | ä½ | å½“å‰å®ç°æ­£ç¡® |
| 84 | `reader.result` å¯èƒ½ä¸º null | ä¸­ | æ·»åŠ æ£€æŸ¥ï¼š`if (ev.target?.result)` å·²å¤„ç† |
| 93 | `settings.avatar` å¯èƒ½ä¸º undefined | ä½ | å·²å¤„ç†ï¼Œä½¿ç”¨é»˜è®¤å€¼ |
| 249 | `new Date(fav.savedAt)` å¦‚æœ savedAt æ— æ•ˆä¼šè¿”å› Invalid Date | ä¸­ | æ·»åŠ æ—¥æœŸæœ‰æ•ˆæ€§æ£€æŸ¥ |

### 4. LessonPlanCard.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 26-30 | `formatList` å‡½æ•°å¤„ç† null/undefined æœ‰ç¼ºé™· | ä¸­ | æ”¹è¿›ï¼š`if (!data) return ''` |
| 70 | `mapLessonPlanToCardData` å‡è®¾ plan æ€»æ˜¯æœ‰æ•ˆ | ä¸­ | æ·»åŠ å‰ç½®æ£€æŸ¥ |
| 82-100 | `handleCopy` ä¸­ `cardData.teachingPreparation?.objectives` å¯èƒ½æ·±å±‚ undefined | ä¸­ | ä½¿ç”¨å¯é€‰é“¾å…¨é¢æ£€æŸ¥ |
| 133-143 | `renderFooter` ä¸­ `plan` å¯èƒ½ä¸º null | ä¸­ | æ·»åŠ æ£€æŸ¥ |

### 5. Sidebar.tsx
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 170 | `currentAvatar` å¯èƒ½ä¸ºæ— æ•ˆå›¾ç‰‡ URL | ä½ | æ·»åŠ  onError å¤„ç†ï¼š`<img onError={(e) => { e.currentTarget.src = APP_LOGO_BASE64; }} />` |
| 209-221 | æ˜µç§°ç¼–è¾‘è¾“å…¥æ¡†çš„ `value` å¯èƒ½å—æ§ä¸éå—æ§åˆ‡æ¢ | ä½ | ç¡®ä¿ value å§‹ç»ˆä¸ºå­—ç¬¦ä¸² |

---

## å…­ã€æœåŠ¡å±‚å¼‚å¸¸å¤„ç†

### 1. geminiService.ts
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 229-292 | `generateWithWorker` æœ‰åŸºæœ¬çš„é”™è¯¯å¤„ç†ï¼Œä½† `fetch` å¯èƒ½æŠ›å‡ºç½‘ç»œé”™è¯¯ | ä¸­ | æ·»åŠ ç½‘ç»œé”™è¯¯é‡è¯•æœºåˆ¶ |
| 277 | `AbortSignal.timeout(80000)` åœ¨æŸäº›æ—§æµè§ˆå™¨ä¸æ”¯æŒ | ä¸­ | æ·»åŠ  polyfill æˆ–é™çº§æ–¹æ¡ˆ |
| 280-286 | é”™è¯¯å¤„ç†æœªåŒºåˆ†ä¸åŒç±»å‹çš„ HTTP é”™è¯¯ | ä¸­ | æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯åˆ†ç±» |
| 298+ | `generateAIPaper` æ–¹æ³•æœªå®Œæ•´å±•ç¤ºï¼Œä½†å¯èƒ½æœ‰ç±»ä¼¼é—®é¢˜ | ä¸­ | ç¡®ä¿æ‰€æœ‰å¼‚æ­¥æ–¹æ³•éƒ½æœ‰é”™è¯¯å¤„ç† |

### 2. downloadService.ts
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 25-57 | `getExportTheme` æœ‰ try-catch ä½†è¿”å› fallbackï¼Œå¯èƒ½å¯¼è‡´ä¸»é¢˜ä¸ä¸€è‡´ | ä½ | è®°å½•é”™è¯¯æ—¥å¿—ä»¥ä¾¿è°ƒè¯• |
| 123+ | `generateDocxBlob` ç­‰ç”Ÿæˆæ–¹æ³•æœªå±•ç¤ºå®Œæ•´ä»£ç  | ä¸­ | ç¡®ä¿æ‰€æœ‰æ–‡ä»¶ç”Ÿæˆæ–¹æ³•éƒ½æœ‰é”™è¯¯å¤„ç† |

### 3. lessonSlice.ts
| è¡Œå· | é—®é¢˜æè¿° | é£é™©ç­‰çº§ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|------|---------|---------|-------------|
| 129-139 | `generateAIPaperThunk` æœ‰ rejectWithValue å¤„ç† | ä½ | å½“å‰å®ç°æ­£ç¡® |
| 141-254 | `generateLessonPlanThunk` æœ‰ rejectWithValue å¤„ç† | ä½ | å½“å‰å®ç°æ­£ç¡®ï¼Œä½†å¯æ·»åŠ æ›´å¤šæ—¥å¿— |

---

## ä¸ƒã€å…³é”®ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³ä¿®å¤ï¼‰
1. **App.tsx:227** - `navigator` SSR å…¼å®¹æ€§é—®é¢˜
2. **App.tsx:341** - `window` SSR å…¼å®¹æ€§é—®é¢˜
3. **AvatarEditor.tsx:41-62** - FileReader ç¼ºå°‘ onerror å¤„ç†
4. **SettingsPage.tsx:80-90** - èƒŒæ™¯å›¾ç‰‡ä¸Šä¼ æœªéªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°
5. **AIPaperGenerator.tsx:997-1039** - æ–‡ä»¶ä¸Šä¼ å¤„ç†ç¼ºå°‘é”™è¯¯å¤„ç†
6. **App.tsx:920-1018** - å›¾ç‰‡å’Œæ–‡ä»¶å¤„ç†ç¼ºå°‘é”™è¯¯å¤„ç†

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®å¤ï¼‰
1. **App.tsx:246-286** - æ”¶è—å¯¼å…¥ JSON.parse é”™è¯¯å¤„ç†
2. **App.tsx:612** - computePlanKey ç©ºå€¼æ£€æŸ¥
3. **LessonPlanCard.tsx:26-30** - formatList å‡½æ•°ç©ºå€¼å¤„ç†
4. **PreviewContainer.tsx:14-20** - displayPlan è®¡ç®—ç©ºå€¼æ£€æŸ¥
5. **geminiService.ts:277** - AbortSignal.timeout å…¼å®¹æ€§

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
1. ç»Ÿä¸€ä½¿ç”¨ Toast ç»„ä»¶æ›¿ä»£ alert
2. æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
3. æ·»åŠ ç½‘ç»œé”™è¯¯é‡è¯•æœºåˆ¶
4. ä¼˜åŒ–çŠ¶æ€é€‰æ‹©å™¨çš„ç©ºå€¼å¤„ç†

---

## å…«ã€é€šç”¨å»ºè®®

1. **æ·»åŠ å…¨å±€é”™è¯¯è¾¹ç•Œ**: åœ¨åº”ç”¨æ ¹ç»„ä»¶æ·»åŠ  Error Boundary æ•è·æœªå¤„ç†çš„ React é”™è¯¯
2. **ç»Ÿä¸€é”™è¯¯å¤„ç†**: åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯å¤„ç†å·¥å…·å‡½æ•°ï¼Œç»Ÿä¸€æ˜¾ç¤ºé”™è¯¯æç¤º
3. **æ·»åŠ æ—¥å¿—è®°å½•**: ä½¿ç”¨æ—¥å¿—åº“ï¼ˆå¦‚ loglevel æˆ– sentryï¼‰è®°å½•ç”Ÿäº§ç¯å¢ƒé”™è¯¯
4. **è¾“å…¥éªŒè¯**: å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯
5. **SSR å…¼å®¹**: ç¡®ä¿æ‰€æœ‰æµè§ˆå™¨ API è°ƒç”¨éƒ½æœ‰ç¯å¢ƒæ£€æŸ¥
6. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
