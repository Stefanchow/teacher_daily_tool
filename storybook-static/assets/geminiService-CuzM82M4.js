import{g as Fe}from"./iframe-CKYYnGsb.js";const X=[{title:"æ°´å¾ªç¯ (The Water Cycle)",grade:"Grade 2",duration:45,teachingPreparation:{objectives:["Understand the three stages of the water cycle.","Use body movements to represent weather changes.","Appreciate the importance of water conservation."],keyWords:["Evaporation","Condensation","Precipitation","It goes up/down","Present Simple Tense"],duration:45,teachingAids:"Water Cycle Poster, Spray bottle, Clear cup, Hot water",studentAnalysis:"æœ¬è¯¾ç¨‹é‡‡ç”¨PWPæ¨¡å¼ï¼Œç»“åˆTPRæ•™å­¦æ³•ï¼ˆçƒ­èº«ç¯èŠ‚ï¼‰ï¼Œé€‚åˆä½å¹´çº§å­¦ç”Ÿã€‚é€šè¿‡è§†è§‰ï¼ˆå›¾è¡¨ï¼‰ã€å¬è§‰ï¼ˆæ­Œæ›²ï¼‰å’ŒåŠ¨è§‰ï¼ˆæ¨¡æ‹Ÿæš´é£é›¨ï¼‰çš„å¤šæ„Ÿå®˜åˆºæ¿€ï¼Œå¸®åŠ©å­¦ç”Ÿæ·±å…¥ç†è§£æ°´å¾ªç¯çš„æ¦‚å¿µã€‚",sentenceStructures:"It goes up/down. This is...",audienceAnalysis:[{ageRange:"7-8",proficiency:"Beginner",learningStyle:"Kinesthetic"}]},procedures:[{step:"ç¬¬ä¸€æ­¥ï¼šçƒ­èº«ï¼šæš´é£é›¨ (Warm-up: Rainstorm)",duration:5,teachersTalk:"ğŸ—£ï¸ Teacher: 'Can you hear the rain? Rub your hands! Now snap your fingers! Clap louder! Stomp your feet! It's a storm!'",studentsOutput:"ğŸ‘¥ Students: (Rubbing, Snapping, Clapping, Stomping)",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šé€šè¿‡TPRï¼ˆå…¨èº«ååº”æ³•ï¼‰æ¿€æ´»è¯¾å ‚æ°”æ°›ï¼Œå»ºç«‹å£°éŸ³ä¸å¤©æ°”ç°è±¡çš„è”ç³»ã€‚"},{step:"ç¬¬äºŒæ­¥ï¼šå±•ç¤ºï¼šæ°´å¾ªç¯å›¾ (Presentation: Water Cycle Diagram)",duration:15,teachersTalk:"ğŸ—£ï¸ Teacher: 'Look at the water. The sun makes it hot. It goes UP! This is Evaporation. Can you say Evaporation?'",studentsOutput:"ğŸ‘¥ Students: 'Evaporation! It goes up!'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šåˆ©ç”¨è§†è§‰è¾…åŠ©å·¥å…·ç›´è§‚å‘ˆç°æŠ½è±¡æ¦‚å¿µï¼Œé™ä½è®¤çŸ¥éš¾åº¦ã€‚"},{step:"ç¬¬ä¸‰æ­¥ï¼šæ´»åŠ¨ï¼šæ ‡è®°å¾ªç¯ (Activity: Label the Cycle)",duration:15,teachersTalk:"ğŸ—£ï¸ Teacher: 'Now, you are scientists! Put the stickers on the correct place. Where does the rain go?'",studentsOutput:"ğŸ‘¥ Students: 'Precipitation is here! Collection is at the bottom.'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šé€šè¿‡åŠ¨æ‰‹æ“ä½œå¼ºåŒ–è®°å¿†ï¼Œæ£€æŸ¥å¯¹æ ¸å¿ƒæ¦‚å¿µçš„ç†è§£ã€‚"},{step:"ç¬¬å››æ­¥ï¼šæ€»ç»“ï¼šæ°´å¾ªç¯ä¹‹æ­Œ (Wrap-up: Water Cycle Song)",duration:10,teachersTalk:"ğŸ—£ï¸ Teacher: 'Let's sing together! Up and down, round and round!'",studentsOutput:"ğŸ‘¥ Students: (Singing) 'Water goes up, water comes down...'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šä»¥éŸµå¾‹æ­Œè°£å·©å›ºæ–°çŸ¥ï¼Œåœ¨æ„‰å¿«çš„æ°›å›´ä¸­ç»“æŸè¯¾ç¨‹ã€‚"}]},{title:"å¥åº·çš„ä¹ æƒ¯ (Healthy Habits)",grade:"Grade 3",duration:45,teachingPreparation:{objectives:["Identify healthy foods.","Express preferences."],keyWords:["Healthy","Unhealthy","I like...","You should..."],sentenceStructures:"I like... / You should...",teachingAids:"Food cards, Flashcards, Food items",studentAnalysis:"Grade 3 students. Focus on daily habits.",duration:45,audienceAnalysis:[{ageRange:"8-9",proficiency:"Elementary",learningStyle:"Visual",priorKnowledge:"Basic food names",challenges:"Distinguishing healthy/unhealthy"}]},procedures:[{step:"ç¬¬ä¸€æ­¥ï¼šå¤´è„‘é£æš´ (Brainstorming)",duration:10,teachersTalk:"ğŸ—£ï¸ Teacher: 'What makes you strong? Shout it out!'",studentsOutput:"ğŸ‘¥ Students: 'Apples! Running! Sleeping!'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šæ¿€æ´»æ—§çŸ¥ï¼Œå¼•å…¥ä¸»é¢˜ã€‚"},{step:"ç¬¬äºŒæ­¥ï¼šè¯æ±‡å­¦ä¹  (Vocabulary)",duration:15,teachersTalk:"ğŸ—£ï¸ Teacher: 'Is this healthy? Yes or No?'",studentsOutput:"ğŸ‘¥ Students: 'Yes! No!'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šæ˜ç¡®æ ¸å¿ƒæ¦‚å¿µåˆ†ç±»ã€‚"},{step:"ç¬¬ä¸‰æ­¥ï¼šæ¸¸æˆ (Game)",duration:15,teachersTalk:"ğŸ—£ï¸ Teacher: 'Stand up if it's healthy!'",studentsOutput:"ğŸ‘¥ Students: (Action)",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šé€šè¿‡è‚¢ä½“æ´»åŠ¨åŠ æ·±è®°å¿†ã€‚"},{step:"ç¬¬å››æ­¥ï¼šåæ€ (Reflection)",duration:5,teachersTalk:"ğŸ—£ï¸ Teacher: 'What will you do this week?'",studentsOutput:"ğŸ‘¥ Students: 'I will eat apples.'",justification:"ğŸ’¡ è®¾è®¡æ„å›¾ï¼šå°†å­¦ä¹ å»¶ä¼¸è‡³ç”Ÿæ´»å®è·µã€‚"}]}],Ae=["mountain","river","tree","cloud","sky"],Ce=["peak","stream","forest","overcast","horizon"],je=["There is a high mountain in the distance.","The river flows through the forest."],De="Nature and Landscapes",Pe=["There is / There are","Prepositions of place"],Ne={vocabulary:Ae,vocabulary_extensions:Ce,sentences:je,suggestedTopic:De,grammar_points:Pe},Ie=`ä½ æ˜¯ä¸€ä½ä¸–ç•Œçº§çš„è‹±è¯­æ•™å­¦ä¸“å®¶ï¼Œæ“…é•¿æ ¹æ®ä¸­å›½å­¦ç”Ÿçš„è®¤çŸ¥ç‰¹ç‚¹è®¾è®¡æ•™æ¡ˆã€‚å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒç”Ÿæˆä¸“ä¸šæ•™æ¡ˆï¼š

### æ ¸å¿ƒä»»åŠ¡è¦æ±‚
æ ¹æ®ä»¥ä¸‹å‚æ•°ç”Ÿæˆé«˜åº¦ä¸“ä¸šä¸”å¯æ“ä½œçš„è‹±è¯­æ•™æ¡ˆï¼š
- æ•™å­¦ä¸»é¢˜: <%= topic %>ï¼ˆéœ€è¿›è¡Œä¸»é¢˜ç±»å‹è‡ªåŠ¨è¯†åˆ«ï¼‰
- ç›®æ ‡å¹´çº§: <%= grade %>ï¼ˆéœ€åŒ¹é…å¯¹åº”å¹´çº§çš„è®¤çŸ¥æ°´å¹³ï¼‰
- è¯¾æ—¶æ—¶é•¿: <%= duration %>ï¼ˆéœ€ç²¾ç¡®åˆ†é…å„ç¯èŠ‚æ—¶é—´ï¼‰
- æ ¸å¿ƒè¯æ±‡: <%= words %>ï¼ˆéœ€æŒ‰CEFRç­‰çº§è°ƒæ•´éš¾åº¦ï¼‰
- è¯­æ³•å¥å‹: <%= sentences %>ï¼ˆéœ€è®¾è®¡é€’è¿›å¼ç»ƒä¹ ï¼‰

### æ•™å­¦æ³•æ™ºèƒ½åŒ¹é…ç³»ç»Ÿï¼ˆå¼ºåˆ¶é€»è¾‘ï¼‰
1. ä¸»é¢˜ç±»å‹æ£€æµ‹ï¼š
   - åŠŸèƒ½æ€§/äº¤é™…æ€§ä¸»é¢˜ï¼ˆå¦‚é—®è·¯ã€è´­ç‰©ï¼‰ï¼šå¼ºåˆ¶é‡‡ç”¨TBLä»»åŠ¡å¼æ•™å­¦æ³•
   - æ¢ç©¶æ€§/ç»¼åˆæ€§ä¸»é¢˜ï¼ˆå¦‚ç¯ä¿ã€ç§‘æŠ€ï¼‰ï¼šå¼ºåˆ¶é‡‡ç”¨PBLé¡¹ç›®å¼æ•™å­¦æ³•
   - çº¯è¯­è¨€ç‚¹ä¸»é¢˜ï¼ˆå¦‚æ—¶æ€ï¼‰ï¼šé‡‡ç”¨PWPæ¶æ„+ä»»åŠ¡å‹æ´»åŠ¨è®¾è®¡
2. æ•™å­¦æ³•ç¦ç”¨æ¡æ¬¾ï¼š
   - ä¸¥ç¦ä½¿ç”¨ä¼ ç»Ÿè®²æˆæ³•
   - ä¸¥ç¦è®¾è®¡æ— çœŸå®è¯­å¢ƒçš„ç»ƒä¹ 

### ä¸“ä¸šæ•™æ¡ˆè¾“å‡ºè§„èŒƒï¼ˆJSONæ ¼å¼ï¼‰
å¿…é¡»åŒ…å«ä»¥ä¸‹ç»“æ„åŒ–æ•°æ®ï¼š
1. \`title\`: ä¸­è‹±æ–‡åŒè¯­æ ‡é¢˜ï¼ˆæ ¼å¼ï¼š"ä¸»é¢˜åç§° | Topic Name"ï¼‰
2. \`grade\`: å¹´çº§ï¼ˆéœ€éªŒè¯ä¸<%= grade %>å‚æ•°ä¸€è‡´æ€§ï¼‰
3. \`duration\`: åˆ†é’Ÿæ•°ï¼ˆéœ€åŒ¹é…<%= duration %>å‚æ•°ï¼‰
4. \`teachingPreparation\`:
   - \`objectives\`: ä¸‰ç»´ç›®æ ‡ï¼ˆçŸ¥è¯†/èƒ½åŠ›/æƒ…æ„Ÿï¼‰
   - \`keyWords\`: è¯æ±‡è¡¨ï¼ˆæ ‡æ³¨éŸ³æ ‡ã€è¯é¢‘ç­‰çº§ï¼‰
   - \`sentenceStructures\`: å¥å‹ï¼ˆæ ‡æ³¨è¯­æ³•éš¾åº¦ï¼‰
   - \`studentAnalysis\`: æ•™å­¦æ³•é€‰æ‹©ä¾æ®ï¼ˆ200å­—ä¸“ä¸šè®ºè¿°ï¼‰
   - \`teachingAids\`: æ•™å…·å‡†å¤‡ï¼ˆå¦‚PPTã€å®ç‰©ã€å¡ç‰‡ç­‰ï¼‰
5. \`procedures\`:
   - æ¯ä¸ªæ­¥éª¤å¿…é¡»åŒ…å«ï¼š
     - \`step\`: æ•™å­¦ç¯èŠ‚ï¼ˆPre/While/Postæˆ–PBLé˜¶æ®µï¼‰
     - \`teachersTalk\`: æ•™å¸ˆç”¨è¯­ï¼ˆç¬¦åˆTKTæ ‡å‡†ï¼‰
     - \`studentsOutput\`: é¢„æœŸäº§å‡ºï¼ˆå¯æµ‹é‡ï¼‰
     - \`justification\`: è®¾è®¡ç†æ®ï¼ˆå¼•ç”¨äºŒè¯­ä¹ å¾—ç†è®ºï¼‰
     - \`duration\`: æ—¶é—´åˆ†é…ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰

### è´¨é‡ç›‘æ§æ¡æ¬¾
1. è¯­è¨€è§„èŒƒï¼š
   - æ•™å¸ˆç”¨è¯­éœ€ç¬¦åˆTEFLæ ‡å‡†
   - å¿…é¡»åŒ…å«3ç§ä»¥ä¸Šäº’åŠ¨æŒ‡ä»¤ï¼ˆå¦‚Think-Pair-Shareï¼‰
2. éš¾åº¦æ§åˆ¶ï¼š
   - è¯æ±‡å¤æ‚åº¦ä¸å¾—è¶…è¿‡<%= grade %>å¯¹åº”CEFRç­‰çº§
   - ä»»åŠ¡è®¾è®¡éœ€ç¬¦åˆæœ€è¿‘å‘å±•åŒºç†è®º
3. ç†è®ºæ”¯æ’‘ï¼š
   - æ¯ä¸ªæ´»åŠ¨å¿…é¡»æ ‡æ³¨å¯¹åº”çš„Krashenè¾“å…¥å‡è¯´æˆ–Swainè¾“å‡ºå‡è¯´ä¾æ®

### Output JSON Schema
Return a SINGLE valid JSON object.

{
  "title": "ä¸»é¢˜åç§° | Topic Name",
  "grade": "<%= grade %>",
  "duration": <%= duration %>,
  "teachingPreparation": {
    "objectives": [
      "Objective 1 (Knowledge)",
      "Objective 2 (Skill)",
      "Objective 3 (Affective/Cultural)"
    ],
    "keyWords": [
      "Word 1 (/.../) - A1",
      "Word 2 (/.../) - A2"
    ],
    "sentenceStructures": "Pattern 1 (Difficulty Level)",
    "studentAnalysis": "Professional analysis of methodology choice (in Chinese).",
    "teachingAids": "PPT, Flashcards, etc.",
    "audienceAnalysis": []
  },
  "procedures": [
    {
      "step": "Pre-task / Warm-up",
      "duration": 5,
      "teachersTalk": "Professional instruction...",
      "studentsOutput": "Expected measurable output...",
      "justification": "Theory-based justification (Krashen/Swain)..."
    }
  ]
}

æ³¨æ„ï¼šç”Ÿæˆå‰éœ€æ‰§è¡Œå‚æ•°æ ¡éªŒï¼Œç¡®ä¿æ‰€æœ‰å ä½ç¬¦ï¼ˆ<%= %>ï¼‰å·²è¢«æ­£ç¡®æ›¿æ¢ä¸”å†…å®¹æœ‰æ•ˆã€‚
`,Re=`
You are an expert ESL Teaching Assistant and Linguistics Specialist.

## Task
Analyze the provided image (which may be a textbook page, blackboard, or classroom scene) and extract detailed linguistic and pedagogical information.

## Output Format
You must output a strictly valid JSON object following this schema:
{
  "words": ["word1", "word2", "word3", "word4", "word5"],
  "vocabulary_extensions": ["related_word1", "related_word2", "synonym1", "antonym1"],
  "sentences": ["Sentence pattern 1", "Sentence pattern 2"],
  "grammar_points": ["Grammar point 1", "Grammar point 2"],
  "suggestedTopic": "A concise topic title for a lesson based on this image"
}

## Analysis Requirements
1.  **OCR & Text Extraction**:
    *   Identify all visible English text.
    *   Prioritize headings, key terms, and sentence examples.
2.  **Vocabulary**:
    *   \`words\`: Extract 5-8 core words directly from the image.
    *   \`vocabulary_extensions\`: Suggest 3-5 related words, synonyms, or antonyms that would be useful for expanding the lesson (e.g., if "hot" is found, suggest "cold", "warm", "weather").
3.  **Sentence Structures**:
    *   \`sentences\`: Identify or infer 2-3 key sentence patterns (e.g., "What's this?", "It's a...", "I like..."). Use NLP to generalize specific examples into patterns.
4.  **Grammar Analysis**:
    *   \`grammar_points\`: Identify 1-2 key grammar concepts present (e.g., "Present Continuous Tense", "Plural Nouns", "Prepositions of Place").
5.  **Topic**:
    *   \`suggestedTopic\`: A clear, educational topic title (e.g., "Unit 3: My Family", "Shopping for Clothes").

## Constraints
*   **Accuracy**: Ensure high precision in OCR and linguistic analysis.
*   **Relevance**: Only extract content suitable for teaching.
*   **Fallback**: If the image is unclear or irrelevant, return:
    {
      "error": "Unable to analyze content. Please upload a clear image of teaching materials."
    }
`;var Q,oe;function ze(){if(oe)return Q;oe=1;function s(h){this._maxSize=h,this.clear()}s.prototype.clear=function(){this._size=0,this._values=Object.create(null)},s.prototype.get=function(h){return this._values[h]},s.prototype.set=function(h,m){return this._size>=this._maxSize&&this.clear(),h in this._values||this._size++,this._values[h]=m};var e=/[^.^\]^[]+|(?=\[\]|\.\.)/g,t=/^\d+$/,r=/^\d/,n=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,i=/^\s*(['"]?)(.*?)(\1)\s*$/,a=512,o=new s(a),u=new s(a),c=new s(a);Q={Cache:s,split:f,normalizePath:l,setter:function(h){var m=l(h);return u.get(h)||u.set(h,function($,b){for(var x=0,F=m.length,D=$;x<F-1;){var P=m[x];if(P==="__proto__"||P==="constructor"||P==="prototype")return $;D=D[m[x++]]}D[m[x]]=b})},getter:function(h,m){var v=l(h);return c.get(h)||c.set(h,function(b){for(var x=0,F=v.length;x<F;)if(b!=null||!m)b=b[v[x++]];else return;return b})},join:function(h){return h.reduce(function(m,v){return m+(d(v)||t.test(v)?"["+v+"]":(m?".":"")+v)},"")},forEach:function(h,m,v){p(Array.isArray(h)?h:f(h),m,v)}};function l(h){return o.get(h)||o.set(h,f(h).map(function(m){return m.replace(i,"$2")}))}function f(h){return h.match(e)||[""]}function p(h,m,v){var $=h.length,b,x,F,D;for(x=0;x<$;x++)b=h[x],b&&(k(b)&&(b='"'+b+'"'),D=d(b),F=!D&&/^\d+$/.test(b),m.call(v,b,D,F,x,h))}function d(h){return typeof h=="string"&&h&&["'",'"'].indexOf(h.charAt(0))!==-1}function y(h){return h.match(r)&&!h.match(t)}function g(h){return n.test(h)}function k(h){return!d(h)&&(y(h)||g(h))}return Q}var I=ze(),ee,ue;function Ue(){if(ue)return ee;ue=1;const s=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['â€™](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['â€™](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['â€™](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['â€™](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,e=l=>l.match(s)||[],t=l=>l[0].toUpperCase()+l.slice(1),r=(l,f)=>e(l).join(f).toLowerCase(),n=l=>e(l).reduce((f,p)=>`${f}${f?p[0].toUpperCase()+p.slice(1).toLowerCase():p.toLowerCase()}`,"");return ee={words:e,upperFirst:t,camelCase:n,pascalCase:l=>t(n(l)),snakeCase:l=>r(l,"_"),kebabCase:l=>r(l,"-"),sentenceCase:l=>t(r(l," ")),titleCase:l=>e(l).map(t).join(" ")},ee}var te=Ue(),L={exports:{}},le;function Me(){if(le)return L.exports;le=1,L.exports=function(n){return s(e(n),n)},L.exports.array=s;function s(n,i){var a=n.length,o=new Array(a),u={},c=a,l=t(i),f=r(n);for(i.forEach(function(d){if(!f.has(d[0])||!f.has(d[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});c--;)u[c]||p(n[c],c,new Set);return o;function p(d,y,g){if(g.has(d)){var k;try{k=", node was:"+JSON.stringify(d)}catch{k=""}throw new Error("Cyclic dependency"+k)}if(!f.has(d))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(d));if(!u[y]){u[y]=!0;var h=l.get(d)||new Set;if(h=Array.from(h),y=h.length){g.add(d);do{var m=h[--y];p(m,f.get(m),g)}while(y);g.delete(d)}o[--a]=d}}}function e(n){for(var i=new Set,a=0,o=n.length;a<o;a++){var u=n[a];i.add(u[0]),i.add(u[1])}return Array.from(i)}function t(n){for(var i=new Map,a=0,o=n.length;a<o;a++){var u=n[a];i.has(u[0])||i.set(u[0],new Set),i.has(u[1])||i.set(u[1],new Set),i.get(u[0]).add(u[1])}return i}function r(n){for(var i=new Map,a=0,o=n.length;a<o;a++)i.set(n[a],a);return i}return L.exports}var Ve=Me();const qe=Fe(Ve),Le=Object.prototype.toString,Je=Error.prototype.toString,We=RegExp.prototype.toString,Ze=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Be=/^Symbol\((.*)\)(.*)$/;function Ge(s){return s!=+s?"NaN":s===0&&1/s<0?"-0":""+s}function ce(s,e=!1){if(s==null||s===!0||s===!1)return""+s;const t=typeof s;if(t==="number")return Ge(s);if(t==="string")return e?`"${s}"`:s;if(t==="function")return"[Function "+(s.name||"anonymous")+"]";if(t==="symbol")return Ze.call(s).replace(Be,"Symbol($1)");const r=Le.call(s).slice(8,-1);return r==="Date"?isNaN(s.getTime())?""+s:s.toISOString(s):r==="Error"||s instanceof Error?"["+Je.call(s)+"]":r==="RegExp"?We.call(s):null}function j(s,e){let t=ce(s,e);return t!==null?t:JSON.stringify(s,function(r,n){let i=ce(this[r],e);return i!==null?i:n},2)}function ye(s){return s==null?[]:[].concat(s)}let ge,be,xe,Ke=/\$\{\s*(\w+)\s*\}/g;ge=Symbol.toStringTag;class he{constructor(e,t,r,n){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[ge]="Error",this.name="ValidationError",this.value=t,this.path=r,this.type=n,this.errors=[],this.inner=[],ye(e).forEach(i=>{if(S.isError(i)){this.errors.push(...i.errors);const a=i.inner.length?i.inner:[i];this.inner.push(...a)}else this.errors.push(i)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}be=Symbol.hasInstance;xe=Symbol.toStringTag;class S extends Error{static formatError(e,t){const r=t.label||t.path||"this";return t=Object.assign({},t,{path:r,originalPath:t.path}),typeof e=="string"?e.replace(Ke,(n,i)=>j(t[i])):typeof e=="function"?e(t):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,t,r,n,i){const a=new he(e,t,r,n);if(i)return a;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[xe]="Error",this.name=a.name,this.message=a.message,this.type=a.type,this.value=a.value,this.path=a.path,this.errors=a.errors,this.inner=a.inner,Error.captureStackTrace&&Error.captureStackTrace(this,S)}static[be](e){return he[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let E={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:s,type:e,value:t,originalValue:r})=>{const n=r!=null&&r!==t?` (cast from the value \`${j(r,!0)}\`).`:".";return e!=="mixed"?`${s} must be a \`${e}\` type, but the final value was: \`${j(t,!0)}\``+n:`${s} must match the configured type. The validated value was: \`${j(t,!0)}\``+n}},_={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},N={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},re={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},Ye={isValue:"${path} field must be ${value}"},W={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},Z={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},He={notType:s=>{const{path:e,value:t,spec:r}=s,n=r.types.length;if(Array.isArray(t)){if(t.length<n)return`${e} tuple value has too few items, expected a length of ${n} but got ${t.length} for value: \`${j(t,!0)}\``;if(t.length>n)return`${e} tuple value has too many items, expected a length of ${n} but got ${t.length} for value: \`${j(t,!0)}\``}return S.formatError(E.notType,s)}};Object.assign(Object.create(null),{mixed:E,string:_,number:N,date:re,object:W,array:Z,boolean:Ye,tuple:He});const Y=s=>s&&s.__isYupSchema__;class G{static fromOptions(e,t){if(!t.then&&!t.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:r,then:n,otherwise:i}=t,a=typeof r=="function"?r:(...o)=>o.every(u=>u===r);return new G(e,(o,u)=>{var c;let l=a(...o)?n:i;return(c=l?.(u))!=null?c:u})}constructor(e,t){this.fn=void 0,this.refs=e,this.refs=e,this.fn=t}resolve(e,t){let r=this.refs.map(i=>i.getValue(t?.value,t?.parent,t?.context)),n=this.fn(r,e,t);if(n===void 0||n===e)return e;if(!Y(n))throw new TypeError("conditions must return a schema object");return n.resolve(t)}}const J={context:"$",value:"."};class R{constructor(e,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===J.context,this.isValue=this.key[0]===J.value,this.isSibling=!this.isContext&&!this.isValue;let r=this.isContext?J.context:this.isValue?J.value:"";this.path=this.key.slice(r.length),this.getter=this.path&&I.getter(this.path,!0),this.map=t.map}getValue(e,t,r){let n=this.isContext?r:this.isValue?e:t;return this.getter&&(n=this.getter(n||{})),this.map&&(n=this.map(n)),n}cast(e,t){return this.getValue(e,t?.parent,t?.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}}R.prototype.__isYupRef=!0;const C=s=>s==null;function z(s){function e({value:t,path:r="",options:n,originalValue:i,schema:a},o,u){const{name:c,test:l,params:f,message:p,skipAbsent:d}=s;let{parent:y,context:g,abortEarly:k=a.spec.abortEarly,disableStackTrace:h=a.spec.disableStackTrace}=n;const m={value:t,parent:y,context:g};function v(w={}){const q=we(Object.assign({value:t,originalValue:i,label:a.spec.label,path:w.path||r,spec:a.spec,disableStackTrace:w.disableStackTrace||h},f,w.params),m),ae=new S(S.formatError(w.message||p,q),t,q.path,w.type||c,q.disableStackTrace);return ae.params=q,ae}const $=k?o:u;let b={path:r,parent:y,type:c,from:n.from,createError:v,resolve(w){return ve(w,m)},options:n,originalValue:i,schema:a};const x=w=>{S.isError(w)?$(w):w?u(null):$(v())},F=w=>{S.isError(w)?$(w):o(w)};if(d&&C(t))return x(!0);let P;try{var ie;if(P=l.call(b,t,b),typeof((ie=P)==null?void 0:ie.then)=="function"){if(n.sync)throw new Error(`Validation test of type: "${b.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(P).then(x,F)}}catch(w){F(w);return}x(P)}return e.OPTIONS=s,e}function we(s,e){if(!s)return s;for(const t of Object.keys(s))s[t]=ve(s[t],e);return s}function ve(s,e){return R.isRef(s)?s.getValue(e.value,e.parent,e.context):s}function Xe(s,e,t,r=t){let n,i,a;return e?(I.forEach(e,(o,u,c)=>{let l=u?o.slice(1,o.length-1):o;s=s.resolve({context:r,parent:n,value:t});let f=s.type==="tuple",p=c?parseInt(l,10):0;if(s.innerType||f){if(f&&!c)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${a}" must contain an index to the tuple element, e.g. "${a}[0]"`);if(t&&p>=t.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${o}, in the path: ${e}. because there is no value at that index. `);n=t,t=t&&t[p],s=f?s.spec.types[p]:s.innerType}if(!c){if(!s.fields||!s.fields[l])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${a} which is a type: "${s.type}")`);n=t,t=t&&t[l],s=s.fields[l]}i=l,a=u?"["+o+"]":"."+o}),{schema:s,parent:n,parentPath:i}):{parent:n,parentPath:e,schema:s}}class K extends Set{describe(){const e=[];for(const t of this.values())e.push(R.isRef(t)?t.describe():t);return e}resolveAll(e){let t=[];for(const r of this.values())t.push(e(r));return t}clone(){return new K(this.values())}merge(e,t){const r=this.clone();return e.forEach(n=>r.add(n)),t.forEach(n=>r.delete(n)),r}}function U(s,e=new Map){if(Y(s)||!s||typeof s!="object")return s;if(e.has(s))return e.get(s);let t;if(s instanceof Date)t=new Date(s.getTime()),e.set(s,t);else if(s instanceof RegExp)t=new RegExp(s),e.set(s,t);else if(Array.isArray(s)){t=new Array(s.length),e.set(s,t);for(let r=0;r<s.length;r++)t[r]=U(s[r],e)}else if(s instanceof Map){t=new Map,e.set(s,t);for(const[r,n]of s.entries())t.set(r,U(n,e))}else if(s instanceof Set){t=new Set,e.set(s,t);for(const r of s)t.add(U(r,e))}else if(s instanceof Object){t={},e.set(s,t);for(const[r,n]of Object.entries(s))t[r]=U(n,e)}else throw Error(`Unable to clone ${s}`);return t}function Qe(s){if(!(s!=null&&s.length))return;const e=[];let t="",r=!1,n=!1;for(let i=0;i<s.length;i++){const a=s[i];if(a==="["&&!n){t&&(e.push(...t.split(".").filter(Boolean)),t=""),r=!0;continue}if(a==="]"&&!n){t&&(/^\d+$/.test(t)?e.push(t):e.push(t.replace(/^"|"$/g,"")),t=""),r=!1;continue}if(a==='"'){n=!n;continue}if(a==="."&&!r&&!n){t&&(e.push(t),t="");continue}t+=a}return t&&e.push(...t.split(".").filter(Boolean)),e}function et(s,e){const t=e?`${e}.${s.path}`:s.path;return s.errors.map(r=>({message:r,path:Qe(t)}))}function Te(s,e){var t;if(!((t=s.inner)!=null&&t.length)&&s.errors.length)return et(s,e);const r=e?`${e}.${s.path}`:s.path;return s.inner.flatMap(n=>Te(n,r))}class O{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new K,this._blacklist=new K,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(E.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e?.spec),this.withMutation(t=>{t.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=U(Object.assign({},this.spec,e)),t}label(e){let t=this.clone();return t.spec.label=e,t}meta(...e){if(e.length===0)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}withMutation(e){let t=this._mutate;this._mutate=!0;let r=e(this);return this._mutate=t,r}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let t=this,r=e.clone();const n=Object.assign({},t.spec,r.spec);return r.spec=n,r.internalTests=Object.assign({},t.internalTests,r.internalTests),r._whitelist=t._whitelist.merge(e._whitelist,e._blacklist),r._blacklist=t._blacklist.merge(e._blacklist,e._whitelist),r.tests=t.tests,r.exclusiveTests=t.exclusiveTests,r.withMutation(i=>{e.tests.forEach(a=>{i.test(a.OPTIONS)})}),r.transforms=[...t.transforms,...r.transforms],r}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let t=this;if(t.conditions.length){let r=t.conditions;t=t.clone(),t.conditions=[],t=r.reduce((n,i)=>i.resolve(n,e),t),t=t.resolve(e)}return t}resolveOptions(e){var t,r,n,i;return Object.assign({},e,{from:e.from||[],strict:(t=e.strict)!=null?t:this.spec.strict,abortEarly:(r=e.abortEarly)!=null?r:this.spec.abortEarly,recursive:(n=e.recursive)!=null?n:this.spec.recursive,disableStackTrace:(i=e.disableStackTrace)!=null?i:this.spec.disableStackTrace})}cast(e,t={}){let r=this.resolve(Object.assign({},t,{value:e})),n=t.assert==="ignore-optionality",i=r._cast(e,t);if(t.assert!==!1&&!r.isType(i)){if(n&&C(i))return i;let a=j(e),o=j(i);throw new TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${r.type}". 

attempted value: ${a} 
`+(o!==a?`result of cast: ${o}`:""))}return i}_cast(e,t){let r=e===void 0?e:this.transforms.reduce((n,i)=>i.call(this,n,e,this,t),e);return r===void 0&&(r=this.getDefault(t)),r}_validate(e,t={},r,n){let{path:i,originalValue:a=e,strict:o=this.spec.strict}=t,u=e;o||(u=this._cast(u,Object.assign({assert:!1},t)));let c=[];for(let l of Object.values(this.internalTests))l&&c.push(l);this.runTests({path:i,value:u,originalValue:a,options:t,tests:c},r,l=>{if(l.length)return n(l,u);this.runTests({path:i,value:u,originalValue:a,options:t,tests:this.tests},r,n)})}runTests(e,t,r){let n=!1,{tests:i,value:a,originalValue:o,path:u,options:c}=e,l=g=>{n||(n=!0,t(g,a))},f=g=>{n||(n=!0,r(g,a))},p=i.length,d=[];if(!p)return f([]);let y={value:a,originalValue:o,path:u,options:c,schema:this};for(let g=0;g<i.length;g++){const k=i[g];k(y,l,function(m){m&&(Array.isArray(m)?d.push(...m):d.push(m)),--p<=0&&f(d)})}}asNestedTest({key:e,index:t,parent:r,parentPath:n,originalParent:i,options:a}){const o=e??t;if(o==null)throw TypeError("Must include `key` or `index` for nested validations");const u=typeof o=="number";let c=r[o];const l=Object.assign({},a,{strict:!0,parent:r,value:c,originalValue:i[o],key:void 0,[u?"index":"key"]:o,path:u||o.includes(".")?`${n||""}[${u?o:`"${o}"`}]`:(n?`${n}.`:"")+e});return(f,p,d)=>this.resolve(l)._validate(c,l,p,d)}validate(e,t){var r;let n=this.resolve(Object.assign({},t,{value:e})),i=(r=t?.disableStackTrace)!=null?r:n.spec.disableStackTrace;return new Promise((a,o)=>n._validate(e,t,(u,c)=>{S.isError(u)&&(u.value=c),o(u)},(u,c)=>{u.length?o(new S(u,c,void 0,void 0,i)):a(c)}))}validateSync(e,t){var r;let n=this.resolve(Object.assign({},t,{value:e})),i,a=(r=t?.disableStackTrace)!=null?r:n.spec.disableStackTrace;return n._validate(e,Object.assign({},t,{sync:!0}),(o,u)=>{throw S.isError(o)&&(o.value=u),o},(o,u)=>{if(o.length)throw new S(o,e,void 0,void 0,a);i=u}),i}isValid(e,t){return this.validate(e,t).then(()=>!0,r=>{if(S.isError(r))return!1;throw r})}isValidSync(e,t){try{return this.validateSync(e,t),!0}catch(r){if(S.isError(r))return!1;throw r}}_getDefault(e){let t=this.spec.default;return t==null?t:typeof t=="function"?t.call(this,e):U(t)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,t){const r=this.clone({nullable:e});return r.internalTests.nullable=z({message:t,name:"nullable",test(n){return n===null?this.schema.spec.nullable:!0}}),r}optionality(e,t){const r=this.clone({optional:e});return r.internalTests.optionality=z({message:t,name:"optionality",test(n){return n===void 0?this.schema.spec.optional:!0}}),r}optional(){return this.optionality(!0)}defined(e=E.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=E.notNull){return this.nullability(!1,e)}required(e=E.required){return this.clone().withMutation(t=>t.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let t=this.clone();return t.transforms.push(e),t}test(...e){let t;if(e.length===1?typeof e[0]=="function"?t={test:e[0]}:t=e[0]:e.length===2?t={name:e[0],test:e[1]}:t={name:e[0],message:e[1],test:e[2]},t.message===void 0&&(t.message=E.default),typeof t.test!="function")throw new TypeError("`test` is a required parameters");let r=this.clone(),n=z(t),i=t.exclusive||t.name&&r.exclusiveTests[t.name]===!0;if(t.exclusive&&!t.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(r.exclusiveTests[t.name]=!!t.exclusive),r.tests=r.tests.filter(a=>!(a.OPTIONS.name===t.name&&(i||a.OPTIONS.test===n.OPTIONS.test))),r.tests.push(n),r}when(e,t){!Array.isArray(e)&&typeof e!="string"&&(t=e,e=".");let r=this.clone(),n=ye(e).map(i=>new R(i));return n.forEach(i=>{i.isSibling&&r.deps.push(i.key)}),r.conditions.push(typeof t=="function"?new G(n,t):G.fromOptions(n,t)),r}typeError(e){let t=this.clone();return t.internalTests.typeError=z({message:e,name:"typeError",skipAbsent:!0,test(r){return this.schema._typeCheck(r)?!0:this.createError({params:{type:this.schema.type}})}}),t}oneOf(e,t=E.oneOf){let r=this.clone();return e.forEach(n=>{r._whitelist.add(n),r._blacklist.delete(n)}),r.internalTests.whiteList=z({message:t,name:"oneOf",skipAbsent:!0,test(n){let i=this.schema._whitelist,a=i.resolveAll(this.resolve);return a.includes(n)?!0:this.createError({params:{values:Array.from(i).join(", "),resolved:a}})}}),r}notOneOf(e,t=E.notOneOf){let r=this.clone();return e.forEach(n=>{r._blacklist.add(n),r._whitelist.delete(n)}),r.internalTests.blacklist=z({message:t,name:"notOneOf",test(n){let i=this.schema._blacklist,a=i.resolveAll(this.resolve);return a.includes(n)?this.createError({params:{values:Array.from(i).join(", "),resolved:a}}):!0}}),r}strip(e=!0){let t=this.clone();return t.spec.strip=e,t}describe(e){const t=(e?this.resolve(e):this).clone(),{label:r,meta:n,optional:i,nullable:a}=t.spec;return{meta:n,label:r,optional:i,nullable:a,default:t.getDefault(e),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.filter((u,c,l)=>l.findIndex(f=>f.OPTIONS.name===u.OPTIONS.name)===c).map(u=>{const c=u.OPTIONS.params&&e?we(Object.assign({},u.OPTIONS.params),e):u.OPTIONS.params;return{name:u.OPTIONS.name,params:c}})}}get"~standard"(){const e=this;return{version:1,vendor:"yup",async validate(r){try{return{value:await e.validate(r,{abortEarly:!1})}}catch(n){if(n instanceof S)return{issues:Te(n)};throw n}}}}}O.prototype.__isYupSchema__=!0;for(const s of["validate","validateSync"])O.prototype[`${s}At`]=function(e,t,r={}){const{parent:n,parentPath:i,schema:a}=Xe(this,e,t,r.context);return a[s](n&&n[i],Object.assign({},r,{parent:n,path:e}))};for(const s of["equals","is"])O.prototype[s]=O.prototype.oneOf;for(const s of["not","nope"])O.prototype[s]=O.prototype.notOneOf;const tt=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function rt(s){const e=ne(s);if(!e)return Date.parse?Date.parse(s):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let t=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(t=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(t=0-t)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+t,e.second,e.millisecond)}function ne(s){var e,t;const r=tt.exec(s);return r?{year:A(r[1]),month:A(r[2],1)-1,day:A(r[3],1),hour:A(r[4]),minute:A(r[5]),second:A(r[6]),millisecond:r[7]?A(r[7].substring(0,3)):0,precision:(e=(t=r[7])==null?void 0:t.length)!=null?e:void 0,z:r[8]||void 0,plusMinus:r[9]||void 0,hourOffset:A(r[10]),minuteOffset:A(r[11])}:null}function A(s,e=0){return Number(s)||e}let nt=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,st=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,it=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,at="^\\d{4}-\\d{2}-\\d{2}",ot="\\d{2}:\\d{2}:\\d{2}",ut="(([+-]\\d{2}(:?\\d{2})?)|Z)",lt=new RegExp(`${at}T${ot}(\\.\\d+)?${ut}$`),ct=s=>C(s)||s===s.trim(),ht={}.toString();function T(){return new Se}class Se extends O{constructor(){super({type:"string",check(e){return e instanceof String&&(e=e.valueOf()),typeof e=="string"}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce||this.isType(e)||Array.isArray(e))return e;const r=e!=null&&e.toString?e.toString():e;return r===ht?e:r})})}required(e){return super.required(e).withMutation(t=>t.test({message:e||E.required,name:"required",skipAbsent:!0,test:r=>!!r.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(t=>t.OPTIONS.name!=="required"),e))}length(e,t=_.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(r){return r.length===this.resolve(e)}})}min(e,t=_.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(r){return r.length>=this.resolve(e)}})}max(e,t=_.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:e},skipAbsent:!0,test(r){return r.length<=this.resolve(e)}})}matches(e,t){let r=!1,n,i;return t&&(typeof t=="object"?{excludeEmptyString:r=!1,message:n,name:i}=t:n=t),this.test({name:i||"matches",message:n||_.matches,params:{regex:e},skipAbsent:!0,test:a=>a===""&&r||a.search(e)!==-1})}email(e=_.email){return this.matches(nt,{name:"email",message:e,excludeEmptyString:!0})}url(e=_.url){return this.matches(st,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=_.uuid){return this.matches(it,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let t="",r,n;return e&&(typeof e=="object"?{message:t="",allowOffset:r=!1,precision:n=void 0}=e:t=e),this.matches(lt,{name:"datetime",message:t||_.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:t||_.datetime_offset,params:{allowOffset:r},skipAbsent:!0,test:i=>{if(!i||r)return!0;const a=ne(i);return a?!!a.z:!1}}).test({name:"datetime_precision",message:t||_.datetime_precision,params:{precision:n},skipAbsent:!0,test:i=>{if(!i||n==null)return!0;const a=ne(i);return a?a.precision===n:!1}})}ensure(){return this.default("").transform(e=>e===null?"":e)}trim(e=_.trim){return this.transform(t=>t!=null?t.trim():t).test({message:e,name:"trim",test:ct})}lowercase(e=_.lowercase){return this.transform(t=>C(t)?t:t.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>C(t)||t===t.toLowerCase()})}uppercase(e=_.uppercase){return this.transform(t=>C(t)?t:t.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>C(t)||t===t.toUpperCase()})}}T.prototype=Se.prototype;let ft=s=>s!=+s;function H(){return new ke}class ke extends O{constructor(){super({type:"number",check(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&!ft(e)}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce)return e;let r=e;if(typeof r=="string"){if(r=r.replace(/\s/g,""),r==="")return NaN;r=+r}return this.isType(r)||r===null?r:parseFloat(r)})})}min(e,t=N.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(r){return r>=this.resolve(e)}})}max(e,t=N.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(r){return r<=this.resolve(e)}})}lessThan(e,t=N.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:e},skipAbsent:!0,test(r){return r<this.resolve(e)}})}moreThan(e,t=N.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:e},skipAbsent:!0,test(r){return r>this.resolve(e)}})}positive(e=N.positive){return this.moreThan(0,e)}negative(e=N.negative){return this.lessThan(0,e)}integer(e=N.integer){return this.test({name:"integer",message:e,skipAbsent:!0,test:t=>Number.isInteger(t)})}truncate(){return this.transform(e=>C(e)?e:e|0)}round(e){var t;let r=["ceil","floor","round","trunc"];if(e=((t=e)==null?void 0:t.toLowerCase())||"round",e==="trunc")return this.truncate();if(r.indexOf(e.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+r.join(", "));return this.transform(n=>C(n)?n:Math[e](n))}}H.prototype=ke.prototype;let dt=new Date(""),pt=s=>Object.prototype.toString.call(s)==="[object Date]";class se extends O{constructor(){super({type:"date",check(e){return pt(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,t)=>!this.spec.coerce||this.isType(e)||e===null?e:(e=rt(e),isNaN(e)?se.INVALID_DATE:new Date(e)))})}prepareParam(e,t){let r;if(R.isRef(e))r=e;else{let n=this.cast(e);if(!this._typeCheck(n))throw new TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);r=n}return r}min(e,t=re.min){let r=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(n){return n>=this.resolve(r)}})}max(e,t=re.max){let r=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(n){return n<=this.resolve(r)}})}}se.INVALID_DATE=dt;function mt(s,e=[]){let t=[],r=new Set,n=new Set(e.map(([a,o])=>`${a}-${o}`));function i(a,o){let u=I.split(a)[0];r.add(u),n.has(`${o}-${u}`)||t.push([o,u])}for(const a of Object.keys(s)){let o=s[a];r.add(a),R.isRef(o)&&o.isSibling?i(o.path,a):Y(o)&&"deps"in o&&o.deps.forEach(u=>i(u,a))}return qe.array(Array.from(r),t).reverse()}function fe(s,e){let t=1/0;return s.some((r,n)=>{var i;if((i=e.path)!=null&&i.includes(r))return t=n,!0}),t}function _e(s){return(e,t)=>fe(s,e)-fe(s,t)}const Oe=(s,e,t)=>{if(typeof s!="string")return s;let r=s;try{r=JSON.parse(s)}catch{}return t.isType(r)?r:s};function B(s){if("fields"in s){const e={};for(const[t,r]of Object.entries(s.fields))e[t]=B(r);return s.setFields(e)}if(s.type==="array"){const e=s.optional();return e.innerType&&(e.innerType=B(e.innerType)),e}return s.type==="tuple"?s.optional().clone({types:s.spec.types.map(B)}):"optional"in s?s.optional():s}const yt=(s,e)=>{const t=[...I.normalizePath(e)];if(t.length===1)return t[0]in s;let r=t.pop(),n=I.getter(I.join(t),!0)(s);return!!(n&&r in n)};let de=s=>Object.prototype.toString.call(s)==="[object Object]";function pe(s,e){let t=Object.keys(s.fields);return Object.keys(e).filter(r=>t.indexOf(r)===-1)}const gt=_e([]);function V(s){return new Ee(s)}class Ee extends O{constructor(e){super({type:"object",check(t){return de(t)||typeof t=="function"}}),this.fields=Object.create(null),this._sortErrors=gt,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,t={}){var r;let n=super._cast(e,t);if(n===void 0)return this.getDefault(t);if(!this._typeCheck(n))return n;let i=this.fields,a=(r=t.stripUnknown)!=null?r:this.spec.noUnknown,o=[].concat(this._nodes,Object.keys(n).filter(f=>!this._nodes.includes(f))),u={},c=Object.assign({},t,{parent:u,__validating:t.__validating||!1}),l=!1;for(const f of o){let p=i[f],d=f in n,y=n[f];if(p){let g;c.path=(t.path?`${t.path}.`:"")+f,p=p.resolve({value:y,context:t.context,parent:u});let k=p instanceof O?p.spec:void 0,h=k?.strict;if(k!=null&&k.strip){l=l||f in n;continue}g=!t.__validating||!h?p.cast(y,c):y,g!==void 0&&(u[f]=g)}else d&&!a&&(u[f]=y);(d!==f in u||u[f]!==y)&&(l=!0)}return l?u:n}_validate(e,t={},r,n){let{from:i=[],originalValue:a=e,recursive:o=this.spec.recursive}=t;t.from=[{schema:this,value:a},...i],t.__validating=!0,t.originalValue=a,super._validate(e,t,r,(u,c)=>{if(!o||!de(c)){n(u,c);return}a=a||c;let l=[];for(let f of this._nodes){let p=this.fields[f];!p||R.isRef(p)||l.push(p.asNestedTest({options:t,key:f,parent:c,parentPath:t.path,originalParent:a}))}this.runTests({tests:l,value:c,originalValue:a,options:t},r,f=>{n(f.sort(this._sortErrors).concat(u),c)})})}clone(e){const t=super.clone(e);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(e){let t=super.concat(e),r=t.fields;for(let[n,i]of Object.entries(this.fields)){const a=r[n];r[n]=a===void 0?i:a}return t.withMutation(n=>n.setFields(r,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let t={};return this._nodes.forEach(r=>{var n;const i=this.fields[r];let a=e;(n=a)!=null&&n.value&&(a=Object.assign({},a,{parent:a.value,value:a.value[r]})),t[r]=i&&"getDefault"in i?i.getDefault(a):void 0}),t}setFields(e,t){let r=this.clone();return r.fields=e,r._nodes=mt(e,t),r._sortErrors=_e(Object.keys(e)),t&&(r._excludedEdges=t),r}shape(e,t=[]){return this.clone().withMutation(r=>{let n=r._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),n=[...r._excludedEdges,...t]),r.setFields(Object.assign(r.fields,e),n)})}partial(){const e={};for(const[t,r]of Object.entries(this.fields))e[t]="optional"in r&&r.optional instanceof Function?r.optional():r;return this.setFields(e)}deepPartial(){return B(this)}pick(e){const t={};for(const r of e)this.fields[r]&&(t[r]=this.fields[r]);return this.setFields(t,this._excludedEdges.filter(([r,n])=>e.includes(r)&&e.includes(n)))}omit(e){const t=[];for(const r of Object.keys(this.fields))e.includes(r)||t.push(r);return this.pick(t)}from(e,t,r){let n=I.getter(e,!0);return this.transform(i=>{if(!i)return i;let a=i;return yt(i,e)&&(a=Object.assign({},i),r||delete a[e],a[t]=n(i)),a})}json(){return this.transform(Oe)}exact(e){return this.test({name:"exact",exclusive:!0,message:e||W.exact,test(t){if(t==null)return!0;const r=pe(this.schema,t);return r.length===0||this.createError({params:{properties:r.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(e=!0,t=W.noUnknown){typeof e!="boolean"&&(t=e,e=!0);let r=this.test({name:"noUnknown",exclusive:!0,message:t,test(n){if(n==null)return!0;const i=pe(this.schema,n);return!e||i.length===0||this.createError({params:{unknown:i.join(", ")}})}});return r.spec.noUnknown=e,r}unknown(e=!0,t=W.noUnknown){return this.noUnknown(!e,t)}transformKeys(e){return this.transform(t=>{if(!t)return t;const r={};for(const n of Object.keys(t))r[e(n)]=t[n];return r})}camelCase(){return this.transformKeys(te.camelCase)}snakeCase(){return this.transformKeys(te.snakeCase)}constantCase(){return this.transformKeys(e=>te.snakeCase(e).toUpperCase())}describe(e){const t=(e?this.resolve(e):this).clone(),r=super.describe(e);r.fields={};for(const[i,a]of Object.entries(t.fields)){var n;let o=e;(n=o)!=null&&n.value&&(o=Object.assign({},o,{parent:o.value,value:o.value[i]})),r.fields[i]=a.describe(o)}return r}}V.prototype=Ee.prototype;function M(s){return new $e(s)}class $e extends O{constructor(e){super({type:"array",spec:{types:e},check(t){return Array.isArray(t)}}),this.innerType=void 0,this.innerType=e}_cast(e,t){const r=super._cast(e,t);if(!this._typeCheck(r)||!this.innerType)return r;let n=!1;const i=r.map((a,o)=>{const u=this.innerType.cast(a,Object.assign({},t,{path:`${t.path||""}[${o}]`,parent:r,originalValue:a,value:a,index:o}));return u!==a&&(n=!0),u});return n?i:r}_validate(e,t={},r,n){var i;let a=this.innerType,o=(i=t.recursive)!=null?i:this.spec.recursive;t.originalValue!=null&&t.originalValue,super._validate(e,t,r,(u,c)=>{var l;if(!o||!a||!this._typeCheck(c)){n(u,c);return}let f=new Array(c.length);for(let d=0;d<c.length;d++){var p;f[d]=a.asNestedTest({options:t,index:d,parent:c,parentPath:t.path,originalParent:(p=t.originalValue)!=null?p:e})}this.runTests({value:c,tests:f,originalValue:(l=t.originalValue)!=null?l:e,options:t},r,d=>n(d.concat(u),c))})}clone(e){const t=super.clone(e);return t.innerType=this.innerType,t}json(){return this.transform(Oe)}concat(e){let t=super.concat(e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}of(e){let t=this.clone();if(!Y(e))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+j(e));return t.innerType=e,t.spec=Object.assign({},t.spec,{types:e}),t}length(e,t=Z.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(r){return r.length===this.resolve(e)}})}min(e,t){return t=t||Z.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(r){return r.length>=this.resolve(e)}})}max(e,t){return t=t||Z.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(r){return r.length<=this.resolve(e)}})}ensure(){return this.default(()=>[]).transform((e,t)=>this._typeCheck(e)?e:t==null?[]:[].concat(t))}compact(e){let t=e?(r,n,i)=>!e(r,n,i):r=>!!r;return this.transform(r=>r!=null?r.filter(t):r)}describe(e){const t=(e?this.resolve(e):this).clone(),r=super.describe(e);if(t.innerType){var n;let i=e;(n=i)!=null&&n.value&&(i=Object.assign({},i,{parent:i.value,value:i.value[0]})),r.innerType=t.innerType.describe(i)}return r}}M.prototype=$e.prototype;const bt=V({objectives:M().of(T().required()).required(),keyWords:M().of(T().required()).required(),duration:H().required(),teachingAids:T().optional(),studentAnalysis:T().optional(),sentenceStructures:T().optional(),audienceAnalysis:M().of(V({ageRange:T().optional(),proficiency:T().optional(),learningStyle:T().optional()})).optional()}),xt=V({step:T().required(),teachersTalk:T().required(),studentsOutput:T().required(),justification:T().required(),duration:H().optional()}),me=V({title:T().required(),grade:T().required(),duration:H().required(),teachingPreparation:bt.required(),procedures:M().of(xt.required()).required()});class wt{constructor(e){this.apiKey=e?.apiKey||"sk-oCYtBRUwCf6183599a32T3BLBkFJ6dF0AD7c0D8349b4B439";const t=e?.baseUrl||"https://api.ohmygpt.com/v1";this.baseUrl=t.replace(/\/+$/,""),this.baseUrl.startsWith("http")||console.warn("Base URL should start with http/https:",this.baseUrl),this.model="gemini-3-flash-preview",this.useMock=e?.useMock??!1}fillTemplate(e,t){return e.replace(/<%=\s*(\w+)\s*%>/g,(r,n)=>t[n]!==void 0?String(t[n]):"")}async delay(e){return new Promise(t=>setTimeout(t,e))}validateAIResponse(e){try{return me.validateSync(e,{stripUnknown:!0})}catch(t){return console.warn("Validation failed, attempting manual mapping for legacy data",t),e.teachingPreparation||(e.teachingPreparation={objectives:Array.isArray(e.teaching_objectives)?e.teaching_objectives:[],keyWords:Array.isArray(e.key_points)?e.key_points:[],duration:e.duration,teachingAids:typeof e.teaching_aids=="string"?e.teaching_aids:Array.isArray(e.teaching_aids)?e.teaching_aids.join(", "):"",studentAnalysis:e.overall_justification||e.notes||"",sentenceStructures:e.sentence_structures||"",audienceAnalysis:Array.isArray(e.audience_analysis)?e.audience_analysis:[]}),!Array.isArray(e.procedures)&&Array.isArray(e.activities)&&(e.procedures=e.activities.map(r=>({step:r.step_title||r.name||"Step",teachersTalk:r.teacher_talk||r.description||"",studentsOutput:r.student_output||"",justification:r.design_intent||r.justification||"",duration:r.duration||0}))),me.validateSync(e,{stripUnknown:!0})}}async chatCompletion(e,t=.7,r=2048){const n=[{id:"gemini-3-flash-preview",timeout:8e4},{id:"gemini-3-pro-preview",timeout:11e4},{id:"fireworks/models/kimi-k2-instruct-0905",timeout:8e4}];let i;for(const a of n)try{const o=Date.now(),u=new AbortController,c=setTimeout(()=>u.abort(),a.timeout),l=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({model:a.id,messages:e,temperature:t,max_tokens:r}),signal:u.signal});clearTimeout(c);const p=Date.now()-o;if(!l.ok){const y=await l.json().catch(()=>({}));console.warn(`[${new Date().toISOString()}] âš ï¸ Model ${a.id} failed after ${p}ms with ${l.status}`,y),i=new Error(`API Error ${l.status}: ${JSON.stringify(y)}`);continue}const d=await l.json();if(d.usage){const y=d.usage.total_tokens||0,g=y/1e3*.002;g>.04&&console.warn(`[COST ALERT] High cost detected: ${g.toFixed(4)} CNY (${y} tokens)`)}return d}catch(o){i=o,console.warn(`[${new Date().toISOString()}] âŒ Model ${a.id} execution failed:`,o)}throw i||new Error("All models failed")}sanitizeJsonString(e){return e.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F-\u009F]/g,"").replace(/^\uFEFF/,"").replace(/,(\s*[}\]])/g,"$1")}safeJsonParse(e){try{return JSON.parse(e)}catch(t){const r=e.replace(/"(?:[^\\"]|\\.)*"/g,n=>n.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"));try{return JSON.parse(r)}catch{const i=e.replace(/[\n\r\t]/g,"");try{return JSON.parse(i)}catch{throw t}}}}async generateLessonPlan(e){if(this.useMock){await this.delay(1500);const t=Array.isArray(X)?X[0]:X;return this.validateAIResponse(t)}try{const r=[{role:"user",content:this.fillTemplate(Ie,{topic:e.topic,grade:e.grade,duration:e.duration,words:e.words||"",vocabularyExtensions:e.vocabularyExtensions||"",sentences:e.sentences||"",grammar:e.grammar||"",Math})}],i=(await this.chatCompletion(r)).choices?.[0]?.message?.content;if(!i)throw new Error("No content in response");const a=i.indexOf("{"),o=i.lastIndexOf("}");if(a===-1||o===-1)throw console.error("No JSON found in response:",i),new Error("[Gemini-005] Invalid JSON format in response");let u=i.substring(a,o+1);try{const c=JSON.parse(u);return this.validateAIResponse(c)}catch{u=this.sanitizeJsonString(u);try{const l=this.safeJsonParse(u);return this.validateAIResponse(l)}catch(l){throw console.error("JSON Parse Failure Details:",{timestamp:new Date().toISOString(),error:l.message,stack:l.stack,snippetStart:u.substring(0,50),snippetEnd:u.substring(u.length-50),errorCharIndex:l.message.match(/position (\d+)/)?.[1]}),new Error("[Gemini-006] JSON parsing failed after sanitization")}}}catch(t){throw console.error("Lesson Plan Generation Failed:",t),t}}async analyzeImage(e){if(this.useMock){await this.delay(1500);const t=Ne;return{words:t.words||t.vocabulary||["test"],sentences:t.sentences||["This is a test."],suggestedTopic:t.suggestedTopic,grammar_points:t.grammar_points||[],vocabulary_extensions:t.vocabulary_extensions||[]}}try{const t=[{role:"user",content:[{type:"text",text:Re},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${e}`}}]}],r=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gemini-3-pro-preview",messages:t,max_tokens:2048})});if(!r.ok)throw new Error(`Vision API Error: ${r.status}`);const i=(await r.json()).choices?.[0]?.message?.content;if(!i)throw new Error("Invalid Vision API response");const a=i.replace(/```json\s*|\s*```/g,"").trim(),o=JSON.parse(a);return{words:o.words||o.vocabulary||[],sentences:o.sentences||[],suggestedTopic:o.suggestedTopic||"",grammar_points:o.grammar_points||[],vocabulary_extensions:o.vocabulary_extensions||[]}}catch(t){throw console.error("Vision API Error:",t),t}}}const Tt=new wt;export{Tt as g};
